#!/usr/bin/env ruby

require 'csv'
require 'pg'
require 'ostruct'

schools = {}
conn = PG.connect(:dbname => 'nhgis')
stadiums = CSV.read('data/stadiums.csv', :headers => true).map do |st|
  OpenStruct.new(st.to_hash)
end

CSV.foreach('data/recruits.csv', :headers => true) do |recruit|
  recruit = OpenStruct.new(recruit.to_hash)
  school = stadiums.detect { |s| [s.team, s.alt].include?(recruit.institution) }
  if school
    schools[school.team] ||= 0
    schools[school.team] += 1
  end
end

#puts schools.sort_by {|k,v| v}.reverse.inspect
